<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Player - Suomi Poikas Hockey Club</title>
    <link rel="stylesheet" href="/styles.css?c=2" />
    <link rel="icon" type="image/png" href="/images/finland-flag-icon.png" />

    <script src="/common.js?c=2"></script>
    <script src="/seasons.js?c=2"></script>
  </head>
  <body>
    <div class="header">
      <h1><a href="/">Suomi Poikas Hockey Club</a></h1>
    </div>
    <nav id="nav"></nav>
    <script>
      buildMenu("#nav")
    </script>
    <div class="container">
      <div class="sidebar">
        <img src="/images/000-placeholder.jpg" alt="Player Photo" id="playerimage" />
        <span class="caption" id="playerimagecaption">Player Photo</span>
      </div>
      <main>
        <article>
          <h2 id="playername">Player Name</h2>
          <p id="bio">Player bio goes here.</p>
          <h2>Player Info</h2>
          <table class="statsheet" id="statsheet">
            <tr>
              <th>Position</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Number</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Age</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Height</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Weight</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Shoots</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Joined</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Years</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Rec Seasons</th>
              <td>-</td>
            </tr>
            <tr>
              <th>C/CC Seasons</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Championships</th>
              <td>-</td>
            </tr>
          </table>
        </article>
        <div class="seasons">
          <h2>Seasons Played with the Poikas</h2>
          <table id="seasons" class="seasons">
            <thead>
              <tr>
                <th data-field="season">Season</th>
                <th data-field="rec">Rec League</th>
                <th data-field="c">C/CC League</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="sisucup">
          <h2>Sisu Cups Won</h2>
          <p>
            The "Sisu Cup" is awarded to the player who demonstrates the most
            <strong>sisu</strong> <em>(pronounced – see’-soo)</em> in a game. Sisu is a Finnish word that doesn't have a
            precise equivalent in English, but is similar to "guts" or "grit" or "perseverance".
          </p>
          <table id="sisucup" class="seasons">
            <thead>
              <tr>
                <th data-field="season">Season</th>
                <th data-field="game">Game</th>
                <th data-field="sisu">Sisu Cup</th>
                <th data-field="notable" class="extra">Notable</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="prevnext">
          <a href="." id="prev">Previous Player</a> Next:
          <a href="." id="next">Next Player</a>
        </div>
      </main>
    </div>
    <script>
      ;(async () => {
        const data = await loadData()

        // Function to extract the player's name from the URL
        const urlSearchParams = new URLSearchParams(window.location.search)
        const playerName = urlSearchParams.get("player")
        if (!playerName) window.location.href = "/"

        const player = data.players.find((p) => p.name === playerName)
        if (!player) window.location.href = "/"

        // redirect to the new player URL that uses CloudFlare functions
        if (player.profileURL !== window.location.pathname) {
          window.location.href = player.profileURL
        }

        // the rest of this is just for legacy support ... probably won't be displayed

        document.title = `Player - ${player.name} - Suomi Poikas Hockey Club`
        $("#playername").innerText = player.name
        $("#bio").innerText = player.bio || ""

        // player image if available
        const img = $("#playerimage")
        const imgCaption = $("#playerimagecaption")
        img.src = player.imageURL
        img.alt = `${player.name} - Player Photo`
        img.onerror = () => (img.src = "/images/000-placeholder.jpg")
        imgCaption.innerText = player.name

        // Player stats

        let champ = "-"
        if (player.championships > 0) {
          champ = `<span class="champion">${player.championships}`
          for (let i = 0; i < player.championships; i++) {
            champ += " 🏆"
          }
          champ += "</span>"
        }

        renderVerticalTable("#statsheet", {
          Position: player.pos,
          Number: player.number,
          Age: player.age,
          Height: player.ht,
          Weight: player.wt,
          Shoots: player.shoots,
          Joined: player.startYear,
          Years: player.years,
          "Rec Seasons": player.seasons.filter((s) => s.level === "Rec").length || "—",
          "C/CC Seasons": player.seasons.filter((s) => s.level === "C").length || "—",
          Championships: champ,
        })

        loadAndDisplaySeasons("#seasons", { player: player.name })

        const sisuCups = [...player.seasons]
          .map((s) => {
            if (!s.games) return []

            const gamesWithSisu = s.games.filter((g) => g.sisu === player.name)

            return gamesWithSisu.map((g) => {
              const seasonLink = `<a href="/season/?year=${s.year}&season=${s.season}&level=${s.level}">${s.year} ${s.season}</a>`
              return {
                season: seasonLink,
                game: g.vs,
                sisu: `🇫🇮 ${g.sisu}`,
                notable: g.notable || "-",
              }
            })
          })
          .flat()

        renderTable("#sisucup", sisuCups)

        // Update the "Next" and "Previous" links

        // find next alphabetical player (first sort it by name)
        data.players.sort((a, b) => (a.name < b.name ? -1 : 1))
        const nextPlayer = data.players.find((p) => p.name > playerName)

        // find previous alphabetical player (first sort it by name)
        data.players.sort((a, b) => (a.name > b.name ? -1 : 1))
        const prevPlayer = data.players.find((p) => p.name < playerName)

        const prevLink = $("#prev")
        const nextLink = $("#next")
        if (prevPlayer) {
          prevLink.href = prevPlayer.profileURL
          prevLink.textContent = prevPlayer.name
        } else {
          prevLink.style.display = "none"
        }
        if (nextPlayer) {
          nextLink.href = nextPlayer.profileURL
          nextLink.textContent = nextPlayer.name
        } else {
          nextLink.style.display = "none"
        }
      })()
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T6M8LZYF5Q"></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag("js", new Date())

      gtag("config", "G-T6M8LZYF5Q")
    </script>
  </body>
</html>
