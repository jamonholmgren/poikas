<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Player - Suomi Poikas Hockey Club</title>
    <link rel="stylesheet" href="/styles.css?c=2" />
    <link rel="icon" type="image/png" href="/images/finland-flag-icon.png" />

    <script src="/common.js?c=2"></script>
  </head>
  <body>
    <div class="header">
      <h1><a href="/">Suomi Poikas Hockey Club</a></h1>
    </div>
    <nav id="nav"></nav>
    <script>
      buildMenu("#nav")
    </script>
    <div class="container">
      <div class="sidebar">
        <div class="photo">
          <img src="/images/000-placeholder.jpg" alt="Season Photo" />
          <span class="caption">Team Photo</span>
        </div>
      </div>
      <main>
        <article>
          <h2 id="seasonname">Season Name</h2>
          <p id="description">Description.</p>
          <table id="seasonresults" class="statsheet">
            <tr>
              <th>Standings/Schedule</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Wins</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Losses</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Ties/OT Losses</th>
              <td>-</td>
            </tr>
            <tr>
              <th>Playoffs Result</th>
              <td>-</td>
            </tr>
          </table>

          <div id="videos" class="videos"></div>

          <h2>Roster</h2>
          <table id="roster" class="roster">
            <thead>
              <tr>
                <th data-field="imageHTML" width="50">Photo</th>
                <th data-field="profileLink">Name</th>
                <th data-field="number" width="30">#</th>
                <th data-field="pos" width="30">Pos</th>
                <th data-field="ht" width="30" class="extra">Ht</th>
                <th data-field="wt" width="30" class="extra">Wt</th>
                <th data-field="shoots" width="30" class="extra">Sh</th>
                <th data-field="years" width="30" class="extra">Yrs</th>
                <th data-field="age" width="30" class="extra">Age</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <h2>Games</h2>
          <table id="games" class="roster">
            <tr>
              <th>Opponent</th>
              <th>Score</th>
              <th>Sisu Cup</th>
              <th class="extra">Notable</th>
            </tr>
          </table>
        </article>
      </main>
    </div>
    <script>
      ;(async () => {
        const urlParams = new URLSearchParams(window.location.search)
        const year = parseInt(urlParams.get("year"), 10)
        const season = urlParams.get("season").toLowerCase()
        const level = urlParams.get("level").toLowerCase()

        const data = await loadData()

        const league = data.leagues.find(
          (t) => t.year === year && t.season.toLowerCase() === season && t.level.toLowerCase() === level
        )

        const roster = league.players

        renderTable("#roster", league.players)

        let seasonName = `Suomi Poikas ${league.year} ${league.season} ${league.level}`
        if (league.aside) seasonName += ` - ${league.aside}`

        $("#seasonname").innerText = seasonName
        $("#description").innerText = league.description || ``

        // loop through table rows and update by label value
        renderVerticalTable("#seasonresults", {
          "Standings/Schedule": league.schedule
            ? `<a href="${league.schedule}" target="_blank">View Standings/Schedule</a>`
            : "-",
          Wins: league.wins,
          Losses: league.losses,
          "Ties/OT Losses": league.ties,
          "Playoffs Result":
            league.playoffs === "champions" ? "üèÜ Champions!" : league.playoffs === "lost" ? "Lost in Playoffs" : "-",
        })

        // add game info to the game table
        const gamesTable = $("#games")
        if (league.games) {
          for (let i = 0; i < league.games.length; i++) {
            const game = league.games[i]
            const row = gamesTable.insertRow(i + 1)
            const res = `${game.result} ${game.us}-${game.them}`

            const sisuPlayer = game.sisu && roster.find((p) => p.name === game.sisu)

            const sisu = game.sisu
              ? sisuPlayer
                ? `üá´üáÆ <a href='/player/?player=${game.sisu}'>${game.sisu}</a>`
                : `üá´üáÆ ${game.sisu}`
              : "-"

            row.insertCell(0).innerHTML = game.vs
            row.insertCell(1).innerHTML = res
            row.insertCell(2).innerHTML = sisu
            const notable = row.insertCell(3)
            notable.innerHTML = game.notable || "-"
            notable.classList.add("extra")
          }
        }

        // add from league.photos to the sidebar
        if (league.photos && league.photos.length > 0) {
          $(".photo img").src = `/images/${league.photos[0]}`

          // if there are more photos, add them
          if (league.photos.length > 1) {
            const photoContainer = $(".photo")
            for (let i = 1; i < league.photos.length; i++) {
              const img = create("img")
              img.src = `/images/${league.photos[i]}`
              img.alt = "Season Photo"
              photoContainer.appendChild(img)
            }
          }
        }

        // if there are any video embeds, add them
        if (league.videos) {
          const videoContainer = $("#videos")
          for (let i = 0; i < league.videos.length; i++) {
            const video = create("iframe")
            video.src = league.videos[i]
            video.title = "YouTube video player"
            video.frameborder = "0"
            video.allow =
              "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            video.allowfullscreen = true
            videoContainer.appendChild(video)
          }
        }
      })()
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-T6M8LZYF5Q"></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag("js", new Date())

      gtag("config", "G-T6M8LZYF5Q")
    </script>
  </body>
</html>
